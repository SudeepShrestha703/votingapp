<div class="container">
  <h1 class="mb-5">
    Voting App
  </h1>

  <div class="row mb-5">
    <div class="col">
      <h3 mb-3 clearfix>
        Voters
        <button mat-icon-button aria-label="Add Voters" class="float-end" (click)="addData(true)">
          <mat-icon>add_box</mat-icon>
        </button>
      </h3>
      <table mat-table [dataSource]="voters" class="mat-elevation-z8">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Name </th>
          <td mat-cell *matCellDef="let element"> {{element.name}} </td>
        </ng-container>

        <ng-container matColumnDef="hasVoted">
          <th mat-header-cell *matHeaderCellDef> Has Voted </th>
          <td mat-cell *matCellDef="let element">
            <button mat-mini-fab class="mat-primary" aria-label="Example icon button with a menu icon">
              <mat-icon *ngIf="element?.hasVoted" class="mat-primary">check</mat-icon>
              <mat-icon *ngIf="!element?.hasVoted" class="mat-primary">clear</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="voterColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: voterColumns;"></tr>
      </table>
    </div>

    <div class="col">
      <h3 mb-3 clearfix>
        Candidates
        <button mat-icon-button aria-label="Add Voters" class="float-end" (click)="addData()">
          <mat-icon>add_box</mat-icon>
        </button>
      </h3>
      <table mat-table [dataSource]="candidates" class="mat-elevation-z8">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef> Name </th>
          <td mat-cell *matCellDef="let element"> {{element.name}} </td>
        </ng-container>

        <ng-container matColumnDef="votes">
          <th mat-header-cell *matHeaderCellDef> Votes </th>
          <td mat-cell *matCellDef="let element">
            {{element.votes}}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="candidateColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: candidateColumns;"></tr>
      </table>
    </div>
  </div>

  <h3> Vote!</h3>

  <div class="row" [formGroup]="castVotingFormGroup">
    <div class="col-md-3">
      <mat-form-field>
        <mat-label>I am</mat-label>
        <mat-select formControlName="voterId">
          <mat-option [value]="item.id" *ngFor="let item of votersList">
            {{ item.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="col-md-3">
      <mat-form-field>
        <mat-label>I vote for</mat-label>
        <mat-select formControlName="candidateId">
          <mat-option [value]="item.id" *ngFor="let item of candidates">
            {{ item.name }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="col-md-2">
      <button mat-flat-button class="mat-primary" [disabled]="!disableFormButton" (click)="castVote()">Submit</button>
    </div>

  </div>

  <ng-template #dialogTemplate>
    <form #myForm="ngForm" novalidate>
      <mat-card appearance="outlined" >
        <mat-card-header>
          <mat-card-title>{{ dialogHeader }} </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-form-field>
            <mat-label>Name</mat-label>
            <input matInput required id="nameFormControl" name="nameFormControl" [(ngModel)]="nameFormControl" #name="ngModel" />
            @if (name.hasError('required')) {
            <mat-error>Name is <strong>required</strong></mat-error>
            }
            @if (name.hasError('duplicate')) {
              <mat-error>Name already <strong>exist</strong></mat-error>
              }
          </mat-form-field>
        </mat-card-content>
  
        <mat-dialog-actions [align]="'end'">
          <button mat-button mat-dialog-close>Cancel</button>
          <button mat-button class="mat-primary" [disabled]="name.hasError('required') || name.hasError('duplicate')" cdkFocusInitial
            (click)="createData(myForm)">Save</button>
        </mat-dialog-actions>
      </mat-card>
    </form>
  </ng-template>
</div>